(self.webpackChunksparkworks_console=self.webpackChunksparkworks_console||[]).push([[367],{91367:function(e,t,r){"use strict";r.r(t),r.d(t,{amplify_s3_album:function(){return E}});var n,i=r(15121),a=r(16304),o=r(31112),s=r(41998),c=r(88774),l=r.n(c),u=r(65513),m=r(6860),p=r(77),f=r(53799),d=r(22594),y=r(30031),h=r(68513),g=r(32152),b=r(57207),v=new Uint8Array(16);function k(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(v)}var w=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function x(e){return"string"==typeof e&&w.test(e)}for(var I=[],T=0;T<256;++T)I.push((T+256).toString(16).substr(1));function A(e,t,r){var n=(e=e||{}).random||(e.rng||k)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(I[e[t+0]]+I[e[t+1]]+I[e[t+2]]+I[e[t+3]]+"-"+I[e[t+4]]+I[e[t+5]]+"-"+I[e[t+6]]+I[e[t+7]]+"-"+I[e[t+8]]+I[e[t+9]]+"-"+I[e[t+10]]+I[e[t+11]]+I[e[t+12]]+I[e[t+13]]+I[e[t+14]]+I[e[t+15]]).toLowerCase();if(!x(r))throw TypeError("Stringified UUID is invalid");return r}(n)}var C=new m.k("S3Album"),E=function(){function e(t){var r=this;(0,o.Z)(this,e),(0,u.r)(this,t),this.contentType="binary/octet-stream",this.level=d.A.Public,this.picker=!0,this.pickerText=y.T.PICKER_TEXT,this.albumItems=[],this.imgArr={},this.list=(0,a.Z)(l().mark(function e(){var t,n,i,a,o;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.level,a=r.track,o=r.identityId,C.debug("Album path: "+(n=void 0===(t=r.path)?"":t)),g.Ke&&"function"==typeof g.Ke.list){e.next=4;break}throw new Error(h.e);case 4:return e.prev=4,e.next=7,g.Ke.list(n,{level:i,track:a,identityId:o});case 7:r.marshal(e.sent),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),C.warn(e.t0);case 14:case"end":return e.stop()}},e,null,[[4,11]])})),this.marshal=function(e){e.forEach(function(e){var t=e.key.toLowerCase().split(".")[1];b.i.has(t)&&(!e.contentType||e.contentType&&"binary/octet-stream"===e.contentType)&&(e.contentType=r.getContentType(e))});var t=e.filter(function(e){return e.contentType&&e.contentType.startsWith("image/")}),n=r.filter?r.filter(t):t;n=r.sort?r.sort(n):n,r.albumItems=n,C.debug("album items",r.albumItems),r.constructImgArray(r.albumItems)},this.constructImgArray=function(e){e.map(function(e){r.imgArr["".concat(e.key)]=e.key})},this.handlePick=function(){var e=(0,a.Z)(l().mark(function e(t){var n,a,o,s,c,u;return l().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.level,s=r.track,c=(void 0===(a=r.path)?"":a)+(0,b.c)(n=t.target.files[0],r.fileToKey),e.prev=3,e.next=6,(0,b.p)(c,n,o,s,n.type,C);case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(3),C.error(e.t0),new Error(e.t0);case 12:Object.keys(r.imgArr).includes(c)?(r.albumItems=(0,i.Z)(r.albumItems),r.imgArr[c]="".concat(c,"-").concat(A())):(u=[].concat((0,i.Z)(r.albumItems),(0,i.Z)(r.filter?r.filter([{key:c}]):[{key:c}])),r.albumItems=r.sort?r.sort(u):u);case 13:case"end":return e.stop()}},e,null,[[3,8]])}));return function(t){return e.apply(this,arguments)}}()}return(0,s.Z)(e,[{key:"getContentType",value:function(e){return(0,p.rI)(e.key,"image/*")}},{key:"componentWillLoad",value:function(){this.list()}},{key:"render",value:function(){var e=this;return(0,u.h)("div",null,(0,u.h)("div",{class:"album-container"},(0,u.h)("div",{class:"grid-row"},this.albumItems.map(function(t){return(0,u.h)("div",{class:"grid-item",key:"key-".concat(t.key)},(0,u.h)("amplify-s3-image",{key:e.imgArr[t.key],imgKey:t.key,level:e.level,path:e.path,identityId:e.identityId,track:e.track,handleOnError:e.handleOnError,handleOnLoad:e.handleOnLoad}),(0,u.h)("span",{class:"img-overlay"}))}))),this.picker&&(0,u.h)("amplify-picker",{pickerText:f.o.get(this.pickerText),inputHandler:function(t){return e.handlePick(t)},acceptValue:"image/*"}))}}]),e}();E.style=":host{--overlay-bg-color:rgba(0, 0, 0, 0.15)}.album-container{-webkit-box-sizing:border-box;box-sizing:border-box;max-width:100%;margin:0 auto;padding:0 2rem}.grid-row{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:-1rem -1rem;padding-bottom:3rem}.grid-item{position:relative;-ms-flex:1 0 22rem;flex:1 0 22rem;-ms-flex-positive:1;flex-grow:1;margin:1rem;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center}amplify-s3-image{--width:22rem;--height:20rem;border-radius:5px;-o-object-fit:cover;object-fit:cover}.img-overlay{display:none;width:100%;height:21rem;position:absolute;top:0;left:0;background-color:var(--overlay-bg-color)}.grid-item:hover .img-overlay{display:block}"}}]);